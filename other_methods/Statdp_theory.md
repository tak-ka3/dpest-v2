# 差分プライバシー違反の検出手法比較

差分プライバシー違反検出には、
**（A）統計的検定ベースの手法（Ding ら “Detecting Violations of Differential Privacy”）** と
**（B）単純サンプリングによる出力分布推定手法**
の 2 種がある。

本比較では、**精度（誤差・検出力・偽陽性／偽陰性・収束速度・必要サンプル数）**、
**計算量（時間・メモリ・スケーラビリティ）**、
**適用範囲**
の観点で両者を評価する。

---

## 方法A: 統計的検定ベース手法

### 概要

隣接データセット (D_1, D_2) に対し、機構 (M) をそれぞれ (n) 回実行して出力を得る。
ある出力事象 (E) に対して：

* (c_1 = |{ i \mid M(D_1)_i \in E }|)
* (c_2 = |{ i \mid M(D_2)_i \in E }|)

これらから
[
P(M(D_1)\in E) > e^\epsilon, P(M(D_2)\in E)
]
が統計的に成立するかを検定する。超幾何分布に基づく Fisher の正確検定などで p 値を計算。

### 精度

* **偽陽性率（Type I error）を事前に制御可能**（統計検定の強み）。
* サンプル数が少ないと検出力が低下。
* 稀な違反事象では、統計的有意差を示すため膨大な試行が必要。
* 誤差は一般に **(O(1/\sqrt{n}))**。

### 計算量

* 計算量は **(O(n \cdot T_M))**（(T_M) は機構 1 回の実行時間）。
* 統計計算自体は軽量。
* ただし **事象 (E) の探索** や **入力ペア探索** によるオーバーヘッドが大きい場合がある。

### 適用範囲・制限

* ブラックボックス扱い可能。
* ただし出力が **連続**・**高次元**の場合、事象 (E) の設定が難しい。
* 稀な違反（近似 DP）には弱い。

### 長所

* 偽陽性率の制御が可能で **厳密な検出** ができる。
* 反例（具体的な事象）を提示でき、デバッグに有用。

### 短所

* 稀な違反を見つけるには膨大なサンプルが必要。
* 事象探索が必要で、アルゴリズム依存のチューニングが必要。

---

## 方法B: サンプリングベース手法

### 概要

隣接データ (D_1, D_2) のもとで機構 (M) を多数回サンプリングし、
出力確率を推定する。

* 推定値
  [
  \hat{P}_1(x) = P(M(D_1)=x),\quad \hat{P}_2(x)
  ]
* そこから
  [
  \epsilon_{\text{emp}} = \max_x |\ln (\hat{P}_1(x)/\hat{P}_2(x))|
  ]
  を計算。
* Clopper–Pearson による信頼区間も利用可能。

### 精度

* モンテカルロ推定のため **収束は (O(1/\sqrt{n}))**。
* 高精度には数千〜数百万の試行が必要。
* 経験的な **下界** に過ぎず、最悪ケース DP を保証できない。
* 偽陰性・偽陽性を制御できない。

### 計算量

* 実装は簡単で、出力記録のみ。
* 統計検定が不要で軽いが、**高精度ほど試行回数が増加**。
* 多次元出力では離散化が必要で、メモリ消費増。

### 適用範囲・制限

* どんなアルゴリズムにも適用可能（要離散化）。
* ただし最悪ケース保証は不可。
* サンプル不足による誤評価のリスクあり。

### 長所

* 実装容易でブラックボックス監査として一般的。
* 実際のモデルやデータセットに即した経験的 ε が得られる。

### 短所

* 統計的保証がない。
* 必要サンプル数が大きく、プライバシー漏洩を過小評価しやすい。

---

# 比較表

| 比較項目       | 統計的テストベース手法                     | サンプリングベース手法                                |
| ---------- | ------------------------------- | ------------------------------------------ |
| **精度・検出力** | 偽陽性率を制御可能、高い検出力。小さな違反は多数サンプル必要。 | モンテカルロ推定。収束は (O(1/\sqrt{n}))。小さな違反は見逃しやすい。 |
| **計算量**    | (M) を (n) 回 + 検定計算。事象探索が重い場合あり。 | (M) を (n) 回実行のみ。高精度には多数試行が必要。              |
| **適用範囲**   | ブラックボックス可。ただし連続・高次元は事象設計が難しい。   | ほぼ全てに適用可（要離散化）。最悪ケース保証は不可。                 |
| **長所**     | 偽陽性を統計的に制御。具体的反例を提示可能。          | 実装容易、経験的 ε 下限を評価しやすい。                      |
| **短所**     | 稀な違反検出は困難。チューニングが必要。            | 統計保証なし。サンプル不足で誤評価リスク。                      |

---

# 結論

* **厳密な検証をしたい場合**
  → **統計的検定ベース手法** が適している（偽陽性率制御・反例提示）。

* **運用段階のブラックボックス監査をしたい場合**
  → **サンプリングベース手法** が簡単で実用的（ただし経験的評価）。

用途に応じて使い分けることが望ましい。

---

# 参考文献

* Ding et al., *Detecting Violations of Differential Privacy*
* Nasr et al., USENIX Security 2023
* NIST SP 800-226 *Guidelines for Evaluating Differential Privacy Guarantees*

---

必要なら、**図表の追加**、**要点だけのまとめ版**、**英語版 Markdown** も作成できます。
