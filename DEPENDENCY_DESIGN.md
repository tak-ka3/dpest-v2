# 依存関係を考慮した演算設計

本ドキュメントでは、演算に与えられる確率変数同士が **独立** か
**依存** かを判定し、依存している場合はサンプリングにフォール
バックする手法について説明する。

## 基本方針

1. `Dist` には確率分布からサンプルを生成する `sampler` を保持する。
   同一の `sampler` を共有する `Dist` 同士は依存しているとみなす。
2. 演算は入力 `Dist` が独立ならば解析的な計算を行い、
   依存している場合は `sampler` から得た共通サンプルを用いて
   経験的に分布を構築する。
3. 生成された結果 `Dist` にも `sampler` を伝播させ、後続の演算で
   再び依存関係を扱えるようにする。

## 具体例：加法 `Add`

1. `x_dist` と `y_dist` が同一の `sampler` を共有していれば、
   依存していると判定し `sampler(n)` で共通サンプルを生成する。
2. 得られたサンプルからヒストグラムを作成し、和の分布を近似する。
3. 結果 `Dist` には和を計算するための新しい `sampler` を設定する。
4. もし `sampler` を共有していなければ従来通り解析的な加法を実行する。

この仕組みにより、入力変数が依存している場合でも自動的に
サンプリングにフォールバックして近似分布を得ることができる。
