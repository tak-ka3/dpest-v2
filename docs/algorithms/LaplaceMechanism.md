# LaplaceMechanism

## アルゴリズムの説明

Laplace機構（Laplace Mechanism）は、差分プライバシーにおける最も基本的なノイズ付加機構です。入力値にLaplace分布に従うノイズを加えることで、プライバシーを保護します。

**アルゴリズム**:
1. 入力値 $x$ を計算
2. Laplace分布からノイズ $\eta \sim \text{Lap}(b)$ をサンプリング（ $b = 1/\varepsilon$ ）
3. $x + \eta$ を出力

**数式**:

$$
M(D) = f(D) + \text{Lap}(1/\varepsilon)
$$

ここで、 $f(D)$ は入力データセット $D$ に対するクエリ関数（デフォルトでは恒等関数）です。

**プライバシー保証**: $0.10$ -DP

**隣接性の定義**: $\|\cdot\|_1$ （L1ノルム）
- 2つのデータベース $D_1, D_2$ が隣接： $\sum_{i} |D_1[i] - D_2[i]| \leq 1$ （合計で1の変化）

## モード

**解析モード**

連続分布（Laplace分布）を格子近似して畳み込み演算を実行します。FFTベースの高速畳み込みにより効率的に計算されます。

## プライバシー損失結果

| 項目 | 値 |
|------|-----|
| 入力サイズ | 1 |
| 推定 ε | 0.1002 |
| 理論 ε | 0.10 |
| 誤差 | +0.0002 (0.2%) |
| 実行時間 | 0.01秒 |

**データソース**: `docs/privacy_loss_report.md`

## 理論的な計算量

### 解析モード

**全体計算量**: $O(g)$ **内訳**:
1. **Laplace分布の生成**: $O(g)$ - 格子点 $g=1000$ 上でLaplace密度関数を評価
2. **Add演算（定数+連続）**: $O(g)$ - 格子のシフトと補間
   - 定数値とLaplace分布の加算は、位置パラメータのシフトで実現

**参照**: `docs/OPERATION_COMPLEXITY_ANALYSIS.md`
- Add演算（離散+連続）: 1.1.2節

## 理論的な誤差（精度）

### 解析モードの誤差構造

LaplaceMechanismは定数+Laplace分布の単純なシフトであり、理論的にはアルゴリズム自体の誤差はありません。

**観測される誤差**: 実測値0.2%の誤差は、格子近似と数値計算による実装誤差です。

- **格子補間誤差**: $O(1/g^2) \approx O(10^{-6})$ （ $g=1000$ ）
- **プライバシー損失比の計算誤差**: 数値積分による微小な誤差

## 理論と実験結果の比較分析

### 精度の分析

| 項目 | 理論値 | 実測値 | 差分 |
|------|--------|--------|------|
| ε | 0.10 | 0.1002 | +0.0002 |
| 相対誤差 | - | 0.2% | - |

**評価**:
- 推定精度は非常に高く、理論値との誤差は **0.2%** のみ
- アルゴリズム自体は単純なシフトなので理論誤差はゼロだが、数値計算の実装誤差が微小に発生

### 実行時間の分析

**計算量**: $O(g)$ - 格子のシフトと補間

**演算数**: $g = 1000$ 回程度

**実行時間**: 0.01秒（極めて高速）

**他手法との比較**:
- DP-Sniper（10秒）と比較して **1000倍高速**
- StatDP（47秒）と比較して **4700倍高速**

### 比較: DP-Sniper vs StatDP vs DPEST

| 手法 | 推定 ε | 実行時間 | 相対速度 |
|------|--------|----------|----------|
| DP-Sniper | 0.099 | 10秒 | 1x |
| StatDP | 0.099 | 47秒 | 0.21x |
| DPEST | 0.1002 | 0.01秒 | **1000x** |

**結論**:
1. **精度**: 3手法とも同等の精度（誤差 ±1%以内）
2. **速度**: DPESTは他手法と比較して **1000倍以上高速**
3. **スケーラビリティ**: LaplaceMechanismのような単純なアルゴリズムでは、解析手法の優位性が顕著
